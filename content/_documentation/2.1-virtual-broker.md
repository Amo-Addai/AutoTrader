---
title: Virtual Broker
permalink: docs/brokers-virtual
---
`./brokers/virtual/virtual_broker.py`

The virtual broker immitates the functionality of a real broker during backtests. It is constructed as a class 
and instantiated before backtesting begins.


## Attributes

```
self.fee                = 0
self.leverage           = 1
self.commission         = 0
self.spread             = 0
self.margin_available   = 0
self.portfolio_balance  = 0
self.pending_positions  = {}
self.open_positions     = {}
self.closed_positions   = {}
self.cancelled_orders   = {}
self.total_trades       = 0
self.profitable_trades  = 0
self.peak_value         = 0
self.low_value          = 0
self.max_drawdown       = 0
self.home_currency      = 'AUD'
self.NAV                = 0
```

## Methods

### Place New Order
```
swf place_order()
```

### Open New Position

```
def open_position()
```


### Close Position

```
def close_position()
```


### Get Open Positions

```
def get_positions()
```


### Calculate Margin Requirements

```
def calculate_margin()
```


```
def update_margin()
```

### Get Price

```
def get_price()
```


### Update Maximum Drawdown

```
def update_MDD()
```



## Utility Functions

Refer to the [Virtual Broker Utility Functions](virtual-utils) for more information.






In backtesting, spread defines the average spread between ask and bid prices. Since historical data gives mid data (mid point between ask and bid), the orders will take the spread into account to adjust market orders. Example, if placing a buy market order, the order will be filled at:
Fill price = data_open + 0.5x spread
For placing a sell market order:
Fill price = data_open â€“ 0.5x spread
Of course, this will not be favourable to the trade, but it is more realistic. 

Commission are taken as a percentage of the trade. 
Commission: 0.005 = 0.005% cost per trade (both opening and closing)
-	eg: $100,000 position costs 0.005% * $100,000 = $5 to open, and another $5 to close.
